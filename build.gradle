/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/8.0.2/samples
 */
plugins {
    id "com.github.node-gradle.node" version "3.5.1"
}

node {
    version = '18.15.0'
    download = true
}

task installRootPackage( type: NpmTask, dependsOn: nodeSetup ) {
    args = [ "install" ]
}

// Common *******************************
task installCommonPackage( type: NpmTask, dependsOn: installRootPackage ) {
    workingDir = new File( "$rootDir/common/" )
    args = [ "install" ]
}

task buildCommon( type: NpmTask, dependsOn: installCommonPackage ) {
    workingDir = new File( "$rootDir/common/" )
    args = [ "run", "build" ]
}

task cleanCommon( type: Delete ) {
    delete = [ "common/lib" ]
}

// Frontend *******************************
task installFrontendPackage( type: NpmTask, dependsOn: installCommonPackage ) {
    workingDir = new File( "$rootDir/frontend/" )
    args = [ "install" ]
}

task buildFrontend( type: NpmTask, dependsOn: [installFrontendPackage, buildCommon] ) {
    workingDir = new File( "$rootDir/frontend/" )
    args = [ "run", "build" ]
}

task cleanFrontend( type: Delete ) {
    delete = [ "frontend/build" ]
}

// Functions *******************************
task installFunctionsPackage( type: NpmTask, dependsOn: installCommonPackage ) {
    workingDir = new File( "$rootDir/functions/" )
    args = [ "install" ]
}

task buildFunctions( type: NpmTask, dependsOn: [installFunctionsPackage, buildCommon] ) {
    workingDir = new File( "$rootDir/functions/" )
    args = [ "run", "build" ]
}

task cleanFunctions( type: Delete ) {
    delete = [ "functions/lib" ]
}

// Global *******************************
task buildProject( dependsOn: [buildFrontend, buildFunctions] ) {
    group = "application"
}

task cleanProject( dependsOn: [cleanCommon, cleanFrontend, cleanFunctions] ) {
    group = "application"
}

